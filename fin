chaque commercant cest 1 jeton

//connexio avec google
message zone message
confirm mot de passe
change mot de passe
email comercnat code
milti langue

test double transaction
mode premium avantage
chargement home

algo affichage produit

la page produit doit recharger



// Coller ce script dans Tinker en production

echo "=== üß™ TESTS PRODUCTION COMPLETS ===\n\n";

$firebaseService = app(App\Services\FirebaseService::class);
$notificationService = app(App\Services\NotificationService::class);

// 1. Test de base Firebase
echo "1. üîê Test connexion Firebase... ";
try {
    $token = $firebaseService->getAccessToken();
    echo "‚úÖ OK (Token: " . substr($token, 0, 20) . "...)\n";
} catch (Exception $e) {
    echo "‚ùå √âCHEC: " . $e->getMessage() . "\n";
    exit;
}

// 2. Test d'envoi de notification
echo "2. üì§ Test envoi notification... ";
$testToken = 'production-test-' . uniqid();
$result = $firebaseService->sendNotification(
    $testToken,
    "üß™ Test Production", 
    "Ceci est un test depuis l'environnement de production!",
    [
        'type' => 'production_test',
        'action_url' => 'https://espacecameroun.com',
        'test_id' => uniqid(),
        'timestamp' => now()->toISOString()
    ]
);

echo $result['success'] ? "‚úÖ ENVOI R√âUSSI\n" : "‚ùå √âCHEC ENVOI\n";
if (!$result['success']) {
    echo "   Erreur: " . $result['error'] . "\n";
    echo "   D√©tails: " . $result['details'] . "\n";
}

// 3. Test avec un utilisateur r√©el
echo "3. üë§ Test avec utilisateur r√©el... ";
$user = App\Models\User::first();
if ($user) {
    $userTokens = App\Models\UserPushToken::where('user_id', $user->id)
        ->where('is_active', true)
        ->count();
    
    echo "Utilisateur #" . $user->id . " - " . $userTokens . " token(s) actif(s)\n";
    
    if ($userTokens > 0) {
        $result = $notificationService->notifyUser(
            $user->id,
            "üéâ Test R√©ussi!",
            "Les notifications fonctionnent parfaitement en production!",
            [
                'type' => 'production_success',
                'action_url' => 'https://espacecameroun.com',
                'timestamp' => now()->toISOString()
            ]
        );
        
        echo "   R√©sultat: " . ($result['success'] ? '‚úÖ NOTIFICATION ENVOY√âE' : '‚ùå √âCHEC') . "\n";
    } else {
        echo "   ‚ÑπÔ∏è  Aucun token actif pour cet utilisateur\n";
    }
} else {
    echo "‚ùå Aucun utilisateur trouv√©\n";
}

// 4. Statistiques syst√®me
echo "4. üìä Statistiques syst√®me...\n";
$totalTokens = App\Models\UserPushToken::count();
$activeTokens = App\Models\UserPushToken::where('is_active', true)->count();
$usersWithTokens = App\Models\User::has('pushTokens')->count();

echo "   - Tokens totaux: " . $totalTokens . "\n";
echo "   - Tokens actifs: " . $activeTokens . "\n";
echo "   - Utilisateurs avec tokens: " . $usersWithTokens . "\n";

// 5. V√©rification environnement
echo "5. üåç Environnement...\n";
echo "   - App: " . config('app.name') . "\n";
echo "   - URL: " . config('app.url') . "\n";
echo "   - HTTPS: " . (request()->secure() ? '‚úÖ Actif' : '‚ùå Inactif') . "\n";
echo "   - Env: " . app()->environment() . "\n";

echo "\n=== üéØ R√âSUM√â ===\n";
echo "Backend Firebase: " . (isset($token) ? '‚úÖ OP√âRATIONNEL' : '‚ùå HORS SERVICE') . "\n";
echo "Envoi notifications: " . ($result['success'] ?? false ? '‚úÖ OP√âRATIONNEL' : '‚ùå PROBL√àME') . "\n";
echo "Environnement: " . (app()->isProduction() ? '‚úÖ PRODUCTION' : '‚ö†Ô∏è   AUTRE') . "\n";

echo "\nüîç Pour tester la r√©ception: \n";
echo "1. Ouvrez https://espacecameroun.com dans Chrome/Firefox\n";
echo "2. Autorisez les notifications\n";
echo "3. Utilisez l'interface de test sur /test-notifications\n";