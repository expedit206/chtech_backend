CREATE TABLE Services (
    id_service INT PRIMARY KEY AUTO_INCREMENT,

-- Références
id_utilisateur INT NOT NULL, id_categorie INT NOT NULL,

-- Informations de base
titre VARCHAR(255) NOT NULL, description TEXT NOT NULL,

-- Type et tarification
type_service ENUM(
    'prix_fixe',
    'tarif_horaire',
    'negociable'
) DEFAULT 'negociable',
prix DECIMAL(10, 2) NULL, -- Peut être NULL si négociable
devise ENUM('XAF', 'EUR', 'USD') DEFAULT 'XAF',

-- Détails professionnels
annees_experience INT,
competences JSON, -- Liste des compétences ["Plomberie", "Électricité", etc.]
qualifications TEXT, -- Diplômes, certifications

-- Localisation
localisation VARCHAR(100) NOT NULL,
ville VARCHAR(100),

-- Disponibilité
disponibilite ENUM(
    'disponible',
    'indisponible',
) DEFAULT 'disponible',
horaires_disponibilite JSON, -- {"lundi": ["09:00-12:00", "14:00-18:00"], ...}

-- Médias
images JSON, -- URLs des images

-- Métadonnées
note_moyenne DECIMAL(3, 2) DEFAULT 0.00,
nombre_avis INT DEFAULT 0,

-- Statut et dates
date_publication DATETIME DEFAULT CURRENT_TIMESTAMP,
date_modification DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
date_expiration DATETIME NULL, -- Pour les services boostés

-- Contraintes
FOREIGN KEY (id_utilisateur) REFERENCES Utilisateurs (id_utilisateur) ON DELETE CASCADE,
FOREIGN KEY (id_categorie) REFERENCES Categories_Service (id_categorie),

-- Index pour les performances
INDEX idx_utilisateur (id_utilisateur),
INDEX idx_categorie (id_categorie),
INDEX idx_localisation (localisation),
INDEX idx_ville (ville),
INDEX idx_type_service (type_service),
INDEX idx_disponibilite (disponibilite),
INDEX idx_est_actif (est_actif),
INDEX idx_est_verifie (est_verifie),
INDEX idx_est_booste (est_booste),
INDEX idx_date_publication (date_publication),
INDEX idx_prix (prix),
INDEX idx_note_moyenne (note_moyenne),

-- Contrainte de prix cohérent
CHECK ((type_service = 'negociable' AND prix IS NULL) OR (type_service != 'negociable' AND prix IS NOT NULL))
);